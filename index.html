<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sonora UC3M – Emisión</title>

<style>
:root{
  --rojo:#be1622;
  --negro:#050307;
  --text:#fff;
  --soft:#bfbfbf;
}

/* === GLOBAL === */
body{
  margin:0;
  font-family: Helvetica, Arial, sans-serif;
  background:radial-gradient(circle at top,#be1622 0%,#3a0307 55%,#000 100%);
  color:#fff;
  height:100vh;display:flex;justify-content:center;align-items:center;
  text-align:center;
  overflow:hidden;
}

/* CONTENEDOR CENTRAL */
.wrap{
  width:90%;
  max-width:900px;
}

/* TITULARES */
h1{font-size:3.2rem;margin-bottom:4px;font-weight:800;letter-spacing:3px;}
h2{font-size:1.1rem;color:#d9d9d9;margin-bottom:22px;font-weight:300;}

/* TARJETA DIRECTO */
.card{
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.18);
  padding:28px 32px;
  border-radius:22px;
  backdrop-filter:blur(18px);
  transition:.25s;
}

/* BLOQUES */
.label{
  font-size:.75rem;
  letter-spacing:4.5px;
  font-weight:700;
  opacity:.95;
  margin-bottom:8px;
  text-transform:uppercase;
}
.item{
  font-size:1.9rem;
  font-weight:700;
  margin-bottom:20px;
}
.sub{
  font-size:1.25rem;
  opacity:.85;
}

/* SI NO ESTÁ EN DIRECTO */
.empty{opacity:.7;font-size:1.1rem;margin-bottom:25px}

/* === QR === */
.qr-box{
  position:fixed;
  right:28px;
  bottom:28px;
  width:115px;
  height:115px;
  z-index:999;
}
.qr-box img{
  width:100%;
  filter:drop-shadow(0 0 6px rgba(255,255,255,.45));
}

/* === MOBILE === */
@media(max-width:800px){
  h1{font-size:2.3rem;}
  .item{font-size:1.65rem;}
  .sub{font-size:1.05rem;}
  .card{padding:22px;}
  .qr-box{width:90px;height:90px;right:18px;bottom:18px;}
}
</style>
</head>
<body>

<div class="wrap">

  <h1>SONORA UC3M</h1>
  <h2>Emisión en directo</h2>

  <div class="card" id="liveBox">
    <div class="label">Ahora</div>
    <div id="now" class="item empty">Cargando...</div>

    <div class="label" style="margin-top:15px;">Siguiente</div>
    <div id="next" class="sub empty">Cargando...</div>
  </div>

</div>

<!-- QR >>> página oficial programación -->
<div class="qr-box">
  <a href="https://sonorauc3m.github.io/programacion/" target="_blank">
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=400x400&color=FFFFFF&bg=00000000&data=https://sonorauc3m.github.io/programacion/" alt="QR Sonora">
  </a>
</div>


<script>
/* Google Sheet */
const SHEET_ID="1g9f3Ue9GtdaTbpxp3DCXncrNPhjnHPk0m9QTXdfSAxM";
const SHEET="Directo";

async function fetchSheet(){
  try{
    const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET}`;
    const raw=await fetch(url).then(r=>r.text());
    const json=JSON.parse(raw.substr(47).slice(0,-2));
    return json.table.rows.map(r=>(r.c||[]).map(c=>c?.v||""));
  }catch(e){console.error(e);return [];}
}

function parse(t){
  const m=t.match(/\d{1,2}:\d{2}/g);
  if(!m) return null;
  const [a,b]=m;const[sH,sM]=a.split(":").map(Number);
  let[eH,eM]=b?b.split(":").map(Number):[sH,sM+60];
  return{ini:sH*60+sM,fin:eH*60+eM,label:t};
}

async function update(){
  const rows=await fetchSheet(); rows.shift();
  const data=rows.map(([d,h,p])=>({d:d?.toLowerCase(),p, ...parse(h)}))
                .filter(x=>x.ini);

  const n=new Date(),min=n.getHours()*60+n.getMinutes();
  const today=data.filter(x=>x.d.includes("martes")||x.d.includes("jueves"));
  
  let now= today.find(x=>min>=x.ini && min<x.fin);
  let next= today.find(x=>x.ini>min);

  /* mostrar */
  document.getElementById("now").textContent=now?now.p:"No hay emisión en directo";
  document.getElementById("next").textContent=next?`${next.label} · ${next.p}`:"Sin más programas";

  /* COLOR SI HAY DIRECTO */
  document.getElementById("liveBox").style.borderColor=now?"#fff":"rgba(255,255,255,.18)";
}

/* Run + refresh 20s */
update();
setInterval(update,20000);
</script>

</body>
</html>
